---
import folder from '../assets/folder.svg';
import folder_yellow from '../assets/folder_yellow.svg';
import open_folder from '../assets/open_folder.svg';
import open_folder_yellow from '../assets/open_folder_yellow.svg';
import right_arrow from '../assets/right_arrow.svg';
import right_arrow_long from '../assets/right_arrow_long.svg';
import arrow from '../assets/arrow.svg';
import arrow_with_line from '../assets/arrow_with_line.svg';

---




<div id="container">
	<div class = "content">
		<div class="navbar">
			<a class="nav_item" target = "_blank" href="https://github.com/Gkhech"> 
				Github
			</a>
			<a class="nav_item" target = "_blank" href="https://www.linkedin.com/in/gor-khechyan-912a4821a/"> 
				Linkedin
			</a>
			<a class="nav_item end" href="/about"> 
				About
			</a>
		</div>
		<div class="title" >Gor_Khechyan</div>
		<div class="position" >Software_Engineer</div>
		
		<div class="inner"> 
			<div class="intro">
				Welcome to my portfolio :)
			</div>
			<div class="instructions">
				you can click on the directories or use the terminal
			</div>


			<div class="directory top" data-folder="closed"> 
				gors_desktop <div id = "gors_desktop" class="folder_icon" data-folder="closed" />
			</div>
		
			<div class="row" data-folder="closed">
				<div class="line"> 
				</div>
				<div class="col">
					
						<div class = "directory_container lvl1" id="lvl1_top" data-folder="closed"> 
							<img class="right_arrow" src={right_arrow.src} alt="right arrow" />
							<div class="directory"> 
								personal_projects <div id = "personal_projects" class="folder_icon" data-folder="closed" />
							</div>
						</div>
						
						<div class="row inside lvl2 " data-folder="closed">
							<div class="line2"> 
							</div>
							<div class="col">

								<!-- <div class="col directory_hold"> -->
									<div class = "directory_container" id="top"> 
											<img class="right_arrow" src={right_arrow.src} alt="right arrow" />
											<div class="directory"> 
												plant_dad <div class="folder_icon" data-folder="closed" />
											</div>

											
									</div>

									<div class = "project_overview_container"  id = "plant_dad">
										<div class = "project_overview" >tech_stack : Nextjs, NestJs, Clerk, React, Tailwindcss, Typescript, Postgres, Redis, OpenAI, Google Cloud Storage, PlantNet API</div>
										<div class = "project_overview" >project_overview : Full-stack Houseplant maintenance web app using fine-tuned LLM models and plantNet for plant identification and tailored care suggestions. Features a simple, user-friendly interface to view all your plants and track their health.</div>
									</div>
								<!-- </div> -->

								<!-- <div class="col directory_hold"> -->
									<div class = "directory_container"> 
										<img class="right_arrow" src={right_arrow.src} alt="right arrow" />
										<div class="directory"> 
											uic_api<div class="folder_icon" data-folder="closed" />
										</div>
									</div>

									<div class = "project_overview_container"  id = "uic_api">
										<div class = "project_overview" >tech_stack : Astro, Go, Auth0, React, Typescript, Postgres, Redis, Graphviz </div>
										<div class = "project_overview" >project_overview : Full-stack RESTful API for developers building solutions with UIC grade distribution, lecture, and professor data. Project features user authentication and generates visual graphs of class prerequisites using Graphviz for clear dependency visualization.</div>
									</div>
								<!-- </div> -->

								<div class = "project_overview_container"  class = "directory_container"> 
									<img class="right_arrow" src={right_arrow.src} alt="right arrow" />
									<div class="directory"> 
										interview_diver<div class="folder_icon" data-folder="closed" />
									</div>
								</div>

								<div class = "project_overview_container"  id = "interview_diver">
									<div class = "project_overview" >tech_stack : Nextjs, Express, React, Tailwindcss, Typescript, Redis, OpenAI </div>
									<div class = "project_overview" >project_overview : Web app that allows individuals to practice behavioral interviews with tailored feedback. </div>
								</div>

								<div class = "directory_container"> 
									<img class="right_arrow" src={right_arrow.src} alt="right arrow" />
									<div class="directory"> 
										word_game<div class="folder_icon" data-folder="closed" />
									</div>
								</div>

								<div class = "project_overview_container" id = "word_game">
									<div class = "project_overview" >tech_stack : Maven, Java </div>
									<div class = "project_overview" >project_overview: Built a client-server word game where multiple clients can connect to the server and play their own individual games simultaneously. Each client session runs independently, allowing users to play without affecting others.</div>
								</div>

								<div class = "directory_container"> 
									<img class="right_arrow" src={right_arrow.src} alt="right arrow" />
									<div class="directory"> 
										assembly_language_interpreter <div class="folder_icon" data-folder="closed"/>
									</div>
								</div>

								<div class = "project_overview_container"  id = "ali">
									<div class = "project_overview" >tech_stack : C++</div>
									<div class = "project_overview" >project_overview : A project that simulates an assembly-like instruction set with operations like DEC, LDA, LDI, STR, ADD, and SUB, using the command pattern for dynamic execution. It manages an accumulator, data register, and memory for data storage and manipulation.</div>
								</div>

								<div class = "directory_container" id="bottom"> 
									<img class="right_arrow" src={right_arrow.src} alt="right arrow" />
									<div class="directory"> 
										open_street_maps<div class="folder_icon" data-folder="closed" />
									</div>
								</div>

								<div class = "project_overview_container"  id = "open_street_maps">
									<div class = "project_overview" >tech_stack : C++, Google Test </div>
									<div class = "project_overview" >project_overview : Developed a custom Dijkstra algorithm to find the shortest path using data points from the UIC campus. Utilized Google test to ensure proper functionality.</div>
								</div>

							</div>

							
						</div>
						
					<div class = "directory_container lvl1" id="lvl1_bottom" data-folder="closed"> 
						<img class="right_arrow" src={right_arrow.src} alt="right arrow" />
						<a class ="directory" target = "_blank" href="https://drive.google.com/file/d/1ABNumKgpDbWP7AUFDB4uL7UODojpNrFE/view?usp=sharing"> 
							resume <div class="circle" />
						</a>
						
					</div>
					
					
				</div>
			</div>

		

			<div class="matches"> 
				<!-- <button id="1">b</button>
				<button id="2">c</button>
				<button id="3">d</button> -->
			</div>

			<div id="mydiv">
				<div id="mydivheader">
					<button class = "minimize_button"></button>
						<div class = "terminal_title"> gors -- zsh </div>
						<div class = "space"></div>
				</div>
				<div class = "terminal_container">
					<div class = "terminal_inner"> 

					<div class = "console_container">						
						<div class="terminal_line">
							<div class="input" contenteditable="false" spellcheck="false" data-prompt="gor@Gors-MacBook-Pro-3 ~ % "></div>
						</div>
					</div>

				</div>
				</div>
			</div>

			<div class="minimized_terminal"/> 

		</div>

	</div>
</div>

<script>
	let curr_dir = "gor";
	let matches: any = document.querySelector<HTMLElement>('.matches');

	interface ParentAndChild{
		parent: string,
		children: Map<string, ParentAndChild>,
	}

	const personal_projects_map: Map<string, ParentAndChild> = new Map();
	personal_projects_map.set("plant_dad", {parent: "personal_projects", children: new Map()});
	personal_projects_map.set("uic_api", {parent: "personal_projects", children: new Map()});
	personal_projects_map.set("word_game", {parent: "personal_projects", children: new Map()});
	personal_projects_map.set("assembly_language_interpreter", {parent: "personal_projects", children: new Map()});
	personal_projects_map.set("open_street_maps", {parent: "personal_projects", children: new Map()});
	
	const resume_map: Map<string, ParentAndChild> = new Map();

	const gors_desktop_map:  Map<string, ParentAndChild> = new Map()
	gors_desktop_map.set("personal_projects", {parent: "gors_desktop", children: personal_projects_map});
	gors_desktop_map.set("resume", {parent: "gors_desktop", children: resume_map});

	const gor_map:  Map<string, ParentAndChild> = new Map()
	gor_map.set("gors_desktop", {parent: "gor", children: gors_desktop_map});
		
	const tree: Map<string, ParentAndChild> = new Map();
	tree.set("gor", {parent: "/", children: gor_map})

	//				if(operation == "cd" && tree.has(curr_dir) && tree.get(curr_dir)?.children.has(command)){
	const parent_map = new Map();
	parent_map.set("gor", "");
	parent_map.set("gors_desktop", "gor");
	parent_map.set("personal_projects", "gors_desktop");
	parent_map.set("resume", "gors_desktop");
	parent_map.set("plant_dad", "personal_projects");
	parent_map.set("uic_api", "personal_projects");
	parent_map.set("word_game", "personal_projects");
	parent_map.set("assembly_language_interpreter", "personal_projects");
	parent_map.set("open_street_maps", "personal_projects");

	const elements = [
		"gor", 
		"gors_desktop",
		"personal_projects",
		"resume",
		"plant_dad",
		"uic_api",
		"word_game",
		"assembly_language_interpreter",
		"open_street_maps"
	]


	

	function calcLine2(){
		const lvl2 = document.querySelector<HTMLElement>(".lvl2");
		if(lvl2){
		const plantDad = lvl2.querySelector("#top");
			const open_street_maps = lvl2.querySelector("#bottom")
			if (plantDad && open_street_maps) {
				const rect = plantDad.getBoundingClientRect();
				const yPosition = rect.top + window.scrollY;

				const rect2 = open_street_maps.getBoundingClientRect();
				const yPosition2 = rect2.top + window.scrollY;
				const line2 = document.querySelector<HTMLElement>(".line2");
				if(line2){
					line2.style.height = `${(yPosition2 - yPosition) + 47}px`;
				}
			}
		}
	}

	function calcLine1(lineExtension: number){
		console.log("lineExtension", lineExtension);
		const top = document.getElementById("lvl1_top");
		const bottom = document.getElementById("lvl1_bottom")
		if (top && bottom) {
			const rect = top.getBoundingClientRect();
			const yPosition = rect.top + window.scrollY;

			const rect2 = bottom.getBoundingClientRect();
			const yPosition2 = rect2.top + window.scrollY;
			const line2 = document.querySelector<HTMLElement>(".line");
			if(line2){
				line2.style.height = `${(yPosition2 - yPosition) + lineExtension}px`;
				console.log("line2.style.height", yPosition2, yPosition);
			}
		}
	}

	function toggleFolder(folder: HTMLElement | null){
		if(folder){
			if(folder.dataset.folder == "closed"){
				folder.style.setProperty(
					'background-image',
					'url("src/assets/open_folder_yellow.svg")',
					'important'
				) 
				folder.dataset.folder = "open";
			}else{
				folder.style.setProperty(
					'background-image',
					'url("src/assets/folder.svg")',
					'important'
				)
				folder.dataset.folder = "closed";
			}
		}
	}


	document.querySelectorAll<HTMLElement>(".directory_container")?.forEach((ele) => {
		ele.addEventListener('click', (e) => {
			const proj_overview_container = ele.nextElementSibling as HTMLElement; // .directory_hold
			
			toggleFolder(ele.querySelector<HTMLElement>(".folder_icon"));

			if (proj_overview_container?.classList.contains("project_overview_container")) {//validate
				if (proj_overview_container) {
					proj_overview_container.style.display = (proj_overview_container.style.display === "none" || !proj_overview_container.style.display) ? "block" : "none";
				}
			}
			calcLine2();
			calcLine1(46.5);
		});
	})

	function getCaretCoordinates(): { x: number; y: number } | null {
		const selection = window.getSelection();
		if (!selection || selection.rangeCount === 0) return null;

		const range = selection.getRangeAt(0).cloneRange();
		range.collapse(true);

		const rects = range.getClientRects();
		if (rects.length === 0) return null;

		const rect = rects[0];
		return { x: rect.left, y: rect.top };
	}

	
	

	dragElement(document.getElementById("mydiv"));
	const content =  document.querySelector<HTMLElement>(".content");
	let contentInnerWidth: number;

	function updateContentInnerWidth(){
		contentInnerWidth = window.innerWidth;
		calcLine2();
		!getComputedStyle(document.querySelector<HTMLElement>(".folder_icon")!).backgroundImage.includes("open_folder_yellow.svg") ? 
			calcLine1(0)
		:
			calcLine1(46.5);
	}
	

	if(matches){
		let i = 1;
		const size = matches.childElementCount;
			matches.onkeydown = function(event: any) {				
				if(event.key == "ArrowDown") {
					if(i >= size) return
					i += 1;
					console.log('down');
					document.getElementById(`${i}`)?.focus;	
				}
				
				if(event.key == "ArrowUp") {
					if(i <= 1) return
					i  -= 1;
					console.log('up');
					document.getElementById(`${i}`)?.focus();
				}

				if(event.key == "Enter"){
					event.preventDefault();
					const input_div = document.querySelector<HTMLElement>('.input');
					console.log("in enter", commandTextSplit);
				
					commandTextSplit[commandTextSplit.length - 1] = document.getElementById(`${i}`)?.innerHTML || " ";
					console.log(commandTextSplit)
					input_div!.innerHTML =  " " + commandTextSplit.join(" ");
					/*
						✅ inputEl.focus();
						Purpose: Puts the keyboard focus on the .input element.

						Why it's needed: You must focus the element before manipulating the caret/selection, or the selection APIs might not work as expected.

						✅ const range = document.createRange();
						Creates a new Range object.

						A Range represents a portion of the DOM (like text or elements).

						Think of it like marking a span of text with a highlighter — you're defining where a selection starts and ends.

						✅ range.selectNodeContents(inputEl);
						Tells the range to cover the entire contents of the .input element.

						If .input has text like "hello world", the range now spans from just before h to just after d.

						✅ range.collapse(false);
						This collapses the range to a single caret position.

						false means collapse to the end of the range (after the last character).

						(true would collapse to the start.)

						This is what moves the caret to the end of the content.

						✅ const selection = window.getSelection();
						Gets the current text selection object for the page.

						This lets you manipulate the caret position or selected text in the document.

						✅ selection.removeAllRanges();
						Clears any existing selections/carets in the document.

						If the user had anything selected, it is now cleared.

						✅ selection.addRange(range);
						Applies the range we created above (collapsed to the end).

						This places the caret at the end of the content in .input.
					*/					

					// Move cursor to end -- logic
						input_div!.focus();
						const range = document.createRange();
						range.selectNodeContents(input_div!);
						range.collapse(false); // set the carot to the end of the range after the end

						const selection = window.getSelection();
						if (selection) {
							selection.removeAllRanges();
							selection.addRange(range);
						}
					//

					matches.style.display = "none";

				}
			};
			
		}

	window.addEventListener('DOMContentLoaded', (e: any) => {
		
		// Select the node that will be observed for mutations
		const targetNode = document.querySelector<HTMLElement>(".input");
		
		if (targetNode) {
			targetNode.addEventListener("input", () => {
				const caret = getCaretCoordinates();
				if (caret) {
					const matches = document.querySelector<HTMLElement>(".matches");
					if (matches) {
						matches.style.left = `${caret.x + window.scrollX}px`;
						matches.style.top = `${caret.y + 20 + window.scrollY}px`; // 20px offset to appear below caret
					}

				}
			});
		}
		});

	updateContentInnerWidth();
	
	window.addEventListener("resize", updateContentInnerWidth);



	function dragElement(elmnt: any) {
		var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
		if (document.getElementById(elmnt.id + "header")) {
    // if present, the header is where you move the DIV from:
    document.getElementById(elmnt.id + "header")!.onmousedown = dragMouseDown;
		} else {
			// otherwise, move the DIV from anywhere inside the DIV:
			elmnt.onmousedown = dragMouseDown;
		}

		function dragMouseDown(e: any) {
			e = e || window.event;
			e.preventDefault();
			// get the mouse cursor position at startup:
			pos3 = e.clientX;
			pos4 = e.clientY;
			document.onmouseup = closeDragElement;
			// call a function whenever the cursor moves:
			document.onmousemove = elementDrag;
		}

		function getOffset( el: any ) {
    var _x = 0;
    var _y = 0;
    while( el && !isNaN( el.offsetLeft ) && !isNaN( el.offsetTop ) ) {
        _x += el.offsetLeft - el.scrollLeft;
        _y += el.offsetTop - el.scrollTop;
        el = el.offsetParent;
    }
    return { top: _y, left: _x };
}

		function elementDrag(e: any) {
			e = e || window.event;
			e.preventDefault();
			// calculate the new cursor position:
			pos1 = pos3 - e.clientX;
			pos2 = pos4 - e.clientY;
			pos3 = e.clientX;
			pos4 = e.clientY;


			// set the element's new position:
			const nextLeft = elmnt.offsetLeft - pos1;
			const nextTop = elmnt.offsetTop - pos2;
			if(nextLeft <= (contentInnerWidth - (75 * 2)) &&  nextLeft >= 0 + 75 ){
				elmnt.style.left = nextLeft + "px";
			}
			if(nextTop <= (content!.scrollHeight - 575) && nextTop >= 0 - 50){
				elmnt.style.top = nextTop + "px";
			}	
		}

		function closeDragElement() {
			/* stop moving when mouse button is released:*/
			document.onmouseup = null;
			document.onmousemove = null;
		}
	}


		function closeLvl1v2(gors_desktop_folder: HTMLElement, lvl1: NodeListOf<HTMLElement>, folder_icon: NodeListOf<HTMLElement>){
			folder_icon?.forEach((folder) => {
				folder.style.setProperty(
					'background-image',
					'url("src/assets/folder.svg")',
					'important'
				)
				folder.dataset.folder = "closed";
			})

			lvl1.forEach((ele) => {
				ele.setAttribute("style", "display: none !important;") 	
			});	

			gors_desktop_folder.dataset.folder = "closed";
			gors_desktop_folder.style.setProperty(
				'background-image',
				'url("src/assets/folder.svg")',
				'important'
			)
			calcLine1(0);
	}

	function openLvl1v2(){

		const gors_desktop_folder = document.querySelector<HTMLElement>("#gors_desktop");
	
		const lvl2 = document.querySelector<HTMLElement>('.lvl2');

		

		const folder_icon = document.querySelectorAll<HTMLElement>('.folder_icon');
		const lvl1 = document.querySelectorAll<HTMLElement>('.lvl1');
		
		
		if(lvl1 && gors_desktop_folder){
			console.log("PREE", gors_desktop_folder.dataset.folder)
	

		console.log("lvl1", lvl1);
			lvl1.forEach((ele) => {
				ele.setAttribute("style", "display: flex !important;") 
			});	

			gors_desktop_folder.dataset.folder = "open";
			gors_desktop_folder.style.setProperty(
				'background-image',
				'url("src/assets/open_folder_yellow.svg")',
				'important'
			);
			calcLine1(46.5);
		}
	}



	function toggleLvl1(){
		const gors_desktop_folder = document.querySelector<HTMLElement>("#gors_desktop");
	
		const lvl2 = document.querySelector<HTMLElement>('.lvl2');

		

		const folder_icon = document.querySelectorAll<HTMLElement>('.folder_icon');
		const lvl1 = document.querySelectorAll<HTMLElement>('.lvl1');
		
		
		if(lvl1 && gors_desktop_folder){
			console.log("PREE", gors_desktop_folder.dataset.folder)
			if(gors_desktop_folder.dataset.folder == "closed" || gors_desktop_folder.dataset.folder == "selected"){
				console.log("called open lvl1")
				openLvl1v2()
			}else{
				closeLvl1v2(gors_desktop_folder, lvl1, folder_icon)
				if(lvl2){
					closelvl2v2(lvl2);
				}
			}
		}
	}

	document.querySelector('.directory.top')?.addEventListener('click', () => {
		toggleLvl1();//open first so we can calc distance
	});

	function closelvl2v2(inside: HTMLElement){
		
		inside.setAttribute("style", "display: none !important")
		document.querySelectorAll<HTMLElement>(".directory_container")?.forEach((ele) => {
			const proj_overview_container = ele.nextElementSibling as HTMLElement; // .directory_hold
			
			const folder = ele.querySelector<HTMLElement>(".folder_icon");
			if(folder){
				folder.style.setProperty(
					'background-image',
					'url("src/assets/folder.svg")',
					'important'
				)
				folder.dataset.folder = "closed";
			}
		
			if (proj_overview_container?.classList.contains("project_overview_container")) {//validate
				if (proj_overview_container) {
					proj_overview_container.style.display = "none";
				}
			}
		})
		inside.dataset.folder = "closed";
		calcLine2();		
	}

	function openlvl2v2(inside: HTMLElement){
		inside.setAttribute("style", "display: flex !important")
		inside.dataset.folder = "open";
		calcLine2();		
	}

	function toggleLvl2(){
		const inside = document.querySelector<HTMLElement>('.lvl2');
					
		if(inside){	
			if(inside.dataset.folder == "closed"){
				openlvl2v2(inside);
			}
			else{
				closelvl2v2(inside);
			}
		}	
	}


	const lvl1 = document.querySelector('.lvl1');
	lvl1?.addEventListener('click', () => {
    // const inside = document.querySelector('.inside');
		toggleLvl2()
		calcLine1(46.5);
  });
		

		
		const terminal_input = document.querySelector<HTMLElement>('.input');


		const terminal = document.querySelector<HTMLElement>('.terminal_container');
		const terminal_inner = terminal?.querySelector<HTMLElement>('.terminal_inner')
		const terminal_title = document.querySelector<HTMLElement>(".terminal_title");
		const minimized_header = document.getElementById('mydivheader');
		const minimized_terminal = document.querySelector<HTMLElement>('.minimized_terminal');

		minimized_terminal?.addEventListener('click', () => {
			if(minimized_header && terminal && terminal_inner && minimize_button && terminal_title)
			{
				console.log("hellof")
				terminal.style.display = "flex";
				terminal_inner.style.display = "block";
				terminal.style.width = "800px";
				terminal.style.height = "500px";
				minimized_header.style.width = "100%";
				minimized_header.style.height = "50px";
				minimized_header.style.backgroundColor = "white";
				minimized_header.style.display = "flex";
				minimized_header.style.border = "none";
				minimize_button.style.display = "block";
				terminal_title.style.display = "block";
				terminal.style.transition = "all 0.3s ease-in-out";

			}
		});


		const minimize_button = document.querySelector<HTMLElement>('.minimize_button');
		const header = document.getElementById('mydivheader');
			console.log(minimize_button)
		minimize_button?.addEventListener('click', (e) => {
			e.stopPropagation(); // to stop it from clicking outer terminal container

			if(terminal && terminal_inner && terminal_input && header && terminal_title){
				// minimize_button.style.display = "none";
				terminal_inner.style.display = "none";
				terminal.style.display = "none";
				header.style.display = "none";

				header.style.width = "150px";
				header.style.height = "150px";
				minimize_button.style.display = "none";
				terminal_title.style.display = "none";
			}
		});


		terminal_input?.addEventListener("focus", (e) => {
			if(terminal_input && terminal_input.textContent == ""){
				terminal_input.textContent = " ";
			}
		});

	

		window.addEventListener('DOMContentLoaded', () => {
		const inputEl = document.querySelector('.input');//i donrt even know if this si hlping
		if (inputEl && terminal_input) {//to ensure prev content doesnt get erased
			terminal_input.textContent = " ";//this seem to have fix the inital issue wher i could delete all the spaces
			inputEl.setAttribute('contenteditable', 'true');
			
		}
	});

	function toggleSelectedFolder(folder: HTMLElement | null){
		if(folder){
			if(folder.dataset.folder === "closed"){
				console.log(getComputedStyle(folder).backgroundImage)
				folder.style.setProperty(
					'background-image',
					'url("src/assets/folder_yellow.svg")',
					'important'
				) 	
				folder.dataset.folder = "selected";
			} else{
				console.log(getComputedStyle(folder).backgroundImage)
				folder.style.setProperty(
					'background-image',
					'url("src/assets/folder.svg")',
					'important'
				) 	
				folder.dataset.folder = "closed";
			}
		}
	}

		function traverse(): Map<string, ParentAndChild>{
			let hold: Map<string, ParentAndChild> = tree;
			let current_map;
			const queue = [];
			queue.push(tree);
			let size = 1;
			while(queue.length != 0){
				size = queue.length;
				for(let i = 0; i < size; i++){
					current_map = queue.pop();
					if(current_map?.size == 0) continue;

					// current_map?.forEach((value, key) => {
					// 	console.log("key: ", key, " value ", value, "curr_Dir", curr_dir)
						
					// 	if(key === curr_dir){
					// 		console.log("found value", value.children);


					// 		return value.children;
					// 	}
						
					// 	queue.unshift(value.children);
					// })
					for (const [key, value] of current_map!.entries()) {
						if (key === curr_dir) {
							console.log("found value", value.children, " key ", key);
							return value.children; // ✅ now exits traverse
						}
						queue.unshift(value.children);
					}
				}
				

			}

			return hold;
		}
	

		function handleCommand(terminal_input: HTMLElement, historyContainer:  Element, commandTextSplit: string[]){
			
				// const hold = document.querySelector<HTMLElement>("#plant_dad");
				// if(hold){
				// 	hold.style.display = "block";
				// }
				//							<div class="input" contenteditable="false" spellcheck="false" data-prompt="gor@Gors-MacBook-Pro-3 ~ % "></div>


				const input = document.querySelector<HTMLElement>(".input");
			
				const operation = commandTextSplit[commandTextSplit.length - 2];
				const command = commandTextSplit[commandTextSplit.length - 1];
				console.log("operation ", operation, "command ", command)
				const hold: Map<string, ParentAndChild> = traverse();//returns the child of a key that matches our current directory 
				console.log("returned", hold);

				const allElementsStartWith: string[] = returnAllElementStartWith(command);
				console.log("allElementsStartWith", allElementsStartWith)

				const filtered = allElementsStartWith.filter((ele) => {
					if(hold.has(ele)){
						return ele;
					}
				})
				console.log("document", document.querySelector<HTMLElement>("#gors_desktop")?.dataset.folder)
				console.log("filtered", filtered);
				console.log("curr_dir", curr_dir);
				if(commandTextSplit.length == 1){
					//singualr input
					if(commandTextSplit[0] == "ls" && curr_dir == "gors_desktop" && document.querySelector<HTMLElement>("#gors_desktop")?.dataset.folder == "selected"){
						console.log("ls tree", tree.get(curr_dir), " ", document.querySelector<HTMLElement>("#gors_desktop")?.dataset.folder)
						toggleLvl1();
						calcLine1(46.5);
					}
				}
				else if(operation == "cd" && hold.has(command)){
					console.log("I HEREE", tree.get(curr_dir))
					toggleSelectedFolder(document.getElementById(command));
					curr_dir = command;
				} 
				else if(operation == "cd" && command == ".." ){
					toggleSelectedFolder(document.getElementById(curr_dir));
					toggleLvl1();
					console.log("cd ..", parent_map.get(curr_dir));
					curr_dir = parent_map.get(curr_dir);
					
				}
				else if(operation == "cd" && tree.has(command)){
					console.log("cd tree", tree.get(curr_dir))
					toggleSelectedFolder(document.getElementById(command));
					curr_dir = command;
				}	else if(operation == "cd" && filtered.length > 0){//fix up
					console.log("returnAllElementStartWith filtered", filtered);

					const children: HTMLElement[] = filtered.map((ele , index) => {
						const autocomplete_option_div = document.createElement("button");
						autocomplete_option_div.id = `${index + 1}`
						autocomplete_option_div.innerHTML = ele;
						return autocomplete_option_div;
					});

					matches = document.querySelector<HTMLElement>('.matches');
					if (matches) {
						matches.replaceChildren();
						children.forEach(child => matches.appendChild(child));
					}



					if(matches)
					matches.style.display = "flex";

					const button = matches?.querySelector("button");

					if(button){
					button!.focus()
					return;
					}
				}else{
					const newLine = document.createElement("div")

					newLine.style.color = "white";
					newLine.style.whiteSpace = "pre-wrap";
					newLine.style.wordBreak = "break-all";
					newLine.style.margin = "0px 10px 0px 10px";
					newLine.style.display = "inline-block";
					// Set content

					newLine.innerHTML = `<div>gor@Gors-MacBook-Pro-3 ~ % zsh: command not found: ${commandTextSplit.join(" ")}</div>`;

					historyContainer.insertBefore(newLine, terminal_input.parentElement);

					// Reset input
					terminal_input.textContent = " ";

					// Scroll to bottom if needed
					historyContainer.scrollTop = historyContainer.scrollHeight;
				}

				console.log("curr_div", curr_dir)

				const newLine = document.createElement("div")
				if (input) {
					newLine.innerHTML = `<div>${input.dataset.prompt}${commandTextSplit.join(" ")}</div>`;
					console.log("newline.innerHTML", newLine.innerHTML)
					input.dataset.prompt = `gor@Gors-MacBook-Pro-3 ${curr_dir == "gor" ? "~" : curr_dir} % `;
				}

				newLine.style.color = "white";
				newLine.style.whiteSpace = "pre-wrap";
				newLine.style.wordBreak = "break-all";
				newLine.style.margin = "0px 10px 0px 10px";
				newLine.style.display = "inline-block";
				// Set content


				historyContainer.insertBefore(newLine, terminal_input.parentElement);

				// Reset input
				terminal_input.textContent = " ";

				// Scroll to bottom if needed
				historyContainer.scrollTop = historyContainer.scrollHeight;
			


		}

		// case "ArrowDown":
		// event.preventDefault();
		let commandTextSplit: string[] = [];
		const newLine = document.createElement("div");

		function returnAllElementStartWith(input: string): string[] {
			return elements.filter((ele) => 
				ele.startsWith(input)
			)
		}

		terminal_input?.addEventListener(
			"keydown",
			(event) => {
				if (event.defaultPrevented) {
					return; // Do nothing if the event was already processed
				}

				if (event.metaKey) {
					event.preventDefault();
					return;
				}

				switch (event.key) {						
					case "Meta":
						event.preventDefault();
						return
					case "Tab":
						const historyContainer = document.querySelector('.console_container');

						if (historyContainer && terminal_input) {
							//! prev issue 
							//!If you're using Astro, Next.js, or a framework that scopes CSS using data-* attributes (like your data-astro-cid-...), 
							//!then dynamically added elements do not automatically get those scoped attributes.

							const commandText = terminal_input.textContent || " ";
							commandTextSplit = commandText.trim().split(" ");

							console.log("*", commandTextSplit.length, "*");
							if(commandTextSplit.length == 1 && commandTextSplit[0] == "ls"){
								handleCommand(terminal_input, historyContainer, commandTextSplit);
							}
							if(commandTextSplit.length >= 2){
								const operation = commandText.trim().split(" ")[commandTextSplit.length - 2];
								const command = commandText.trim().split(" ")[commandTextSplit.length - 1];


								handleCommand(terminal_input, historyContainer, commandTextSplit);
									
							}else{

								if(commandText.trim() == "ls gors_desktop"){
									toggleLvl1();
								}

								if(commandText.trim() == "ls personal_projects"){
										toggleLvl2();
										calcLine1(46.5);
								}


								// newLine.style.color = "white";
								// newLine.style.whiteSpace = "pre-wrap";
								// newLine.style.wordBreak = "break-all";
								// newLine.style.margin = "0px 10px 0px 10px";
								// newLine.style.display = "inline-block";
								// // Set content

								// newLine.innerHTML = `<div>gor@Gors-MacBook-Pro-3 ${curr_dir} % ${commandText}</div>`;

								// historyContainer.insertBefore(newLine, terminal_input.parentElement);

								// // Reset input
								// terminal_input.textContent = " ";

								// // Scroll to bottom if needed
								// historyContainer.scrollTop = historyContainer.scrollHeight;
							}
						}
						event.preventDefault();
						
						break;
					case "Delete":
						if(terminal_input.textContent == ""){
							event.preventDefault();
						}
						break;
					default:
						// terminal_input.textContent = " " + terminal_input.textContent; 
						if(terminal_input.textContent == ""){
							terminal_input.textContent += " ";
						}
        		return; // Quit when this doesn't handle the key event.
				}
				// Cancel the default action to avoid it being handled twice
			},
			true,
		);
</script>

<style>
	#mydiv {
		position: absolute;
		z-index: 9;
		background-color: transparent;
		top: 45%;
		left: 70%;
		transform: translate(-50%, -50%);
	}

	#mydivheader {
		position: relative;
		cursor: move;
		z-index: 10;
		width: 100%;
		height: 50px;
		border: none;
		background-color: white;
		display: flex;
		justify-content: space-between;
		align-items: center;
		display: none;
		border-top-left-radius: 15px;
		border-top-right-radius: 15px;
	}
	html, body {
    /* overflow: hidden; */
    overscroll-behavior: none;
  }
	.content {
  	overflow-y: auto;           /* Enable vertical scrolling */
		position: relative;
		display: flex;
		width: 100%;
		height: 100%;
		flex-direction: column;
	}
	.navbar{
		font-family: "Bayon";
		display: flex;
		width: 100%;
		margin-top: 20px;
		margin-bottom: 20px;
		gap: 20px;
		justify-content: end;
		align-items: center;
		/* background-color: black; */
	}
	.end {
		margin-right: 35px;
	}
	.nav_item {
		color: white;
		font-size: x-large;
	}
	.title {
		font-family: "Bayon";
		align-self: center;
		line-height: 125px;
		font-size: 10.5em;
		color: white;
	}
	.position {
		font-family: "Bayon";
		align-self: center;
		font-size: 2.5em;
		margin-top: 20px;
		color: white;
	}
	.content .inner{
		width: 100%;
		height: 100%;
		margin-top: 50px;
		margin-bottom: 50px;
		margin-left: 35px;
		position: relative;
		/* background-color: grey; */
	}
	.intro{
		align-self: center;
		font-size: 3.5em;
		color: white;
	}
	.inner .instructions{
		font-size: 2em;
		color: white;
	}
	.row{
		display: flex;
		flex-direction: row;
		/* background-color: brown; */
	}
	.col{
		display: flex;
		flex-direction: column;
	}
	.row{
		display: flex;
		flex-direction: row;
		/* background-color: brown; */
	}
	.directory_container{
		margin-top: 20px;
		display: flex;
		flex-direction: row;
		background-color: bl;
	}
	.directory{
		display: flex;
		font-size: 2em;
		color: white;
		align-items: center;
		width: fit-content;
		border-bottom: 2.5px solid white;
	}
	.right_arrow{
		width: 50px;
	}
	.directory:link{
		text-decoration: none;
	}
	.nav_item:link{
		text-decoration: none;
	}
	.line{
		width: 2.5px;
		flex-shrink: 0;       /* prevents shrinking in flex layouts */
		background-color: white;
		margin-left: 5px;
	}
	.line2{
		width: 2.5px;
		flex-shrink: 0;       /* prevents shrinking in flex layouts */
		background-color: white;
		margin-left: 5px;
	}
	.project_overview_container{
		display: none;
		margin-left: 55px;
	}
	.project_overview{
		margin-top: 20px;
		font-size: 24px;
		color: white;
		width: 50vw;
	}
	.inside{
		align-self: flex-start;
		margin-left: 50px;
	}
	.lvl1{
		display: none;
	}
	.lvl2{
		display: none;
	}
	.top{
		margin-top: 50px;
	}
	.terminal_container{
		display: none;
		width: 150px;
		height: 100px;
		background-color: #323232;
		z-index: 10;
		border-bottom-left-radius: 20px;
		border-bottom-right-radius: 20px;
		border-bottom: 2.5px solid white;
		border-left: 2.5px solid white;
		border-right: 2.5px solid white;
		transition: all 0.3s ease-in-out;
		cursor: move;
	}
	.header{
		z-index: 15;
		width: 100%;
		height: 50px;
		background-color: white;
		border-top-left-radius: 15px;
		border-top-right-radius: 15px;
		display: flex;
		justify-content: space-between;
		align-items: center;

	}
	.minimize_button{
		display: none;
		margin-left: 10px;
		width: 20px;
		height: 20px;
		background-color: #FFDD00;
		border-radius: 50px;
	}
	.space{
		width: 40px;
		height: 40px;
		margin-right: 5px;
	}
	.terminal_title{
		display: none;
	}
	.terminal_inner{
		display: none;
		height: 100%;
	}
	.console_container{
		display: flex;
		align-items: start;
		flex-direction: column;
		overflow:scroll;
		height: 450px;
	}
	.terminal_line{
		width: 100%;
	}
	.matches{
		position: fixed;
		width: 100px;
		height: 150px;
		display: none;
		flex-direction: column;
		/* right: 0;
		top: 35px; */
		margin-top: 10px;
		background-color: black;
		z-index: 50;
	}
	.input {
		outline: none;
		white-space: pre-wrap;
		word-break: break-all;
		caret-color: white;
		color: white;
		display: inline-block;
		margin: 0px 10px 0px 10px;
		
	}
	.history{
		outline: none;
		white-space: pre-wrap;
		word-break: break-all;
		caret-color: white;
		color: white;
		min-height: 1em;
		margin: 10px;
	}
	.input::before {
		content: attr(data-prompt);
		white-space: pre;
		color: white;
	}
	.minimized_terminal{
		width: 100px;
		height: 100px;
		position: fixed;
		background-color: #323232;
		z-index: 15;
		bottom: 20px;
		right: 20px;
		border: 2.5px solid white;
		border-radius: 15px;
		background-color: #323232;

		transition: all 0.3s ease-in-out;
	}







	.folder_icon {
		margin-left: 10px;
		width: 3rem;
		height: 3rem;
		background-image: url("../assets/folder.svg");
		background-size: cover;
		transition: background-image 0.3s ease-in-out;
	}
	.folder_icon:hover {
		background-image: url("../assets/folder_yellow.svg");
	}
	.circle {
		margin-left: 10px;
		width: 2rem;
		height: 2rem;
		background-image: url("../assets/circle.svg");
		background-size: cover;
		transition: background-image 0.3s ease-in-out;
	}
	.circle:hover {
		background-image: url("../assets/circle.svg");
	}

	#container {
		font-family: "Oswald";
		background-image: url("../assets/background.png");
		/* background-position: center; */
		background-repeat: no-repeat;
		background-size: cover;
		background-attachment: fixed; /* ✅ Keeps background stationary */
		height: 100vh;
	}


	@media (max-width: 800px) {
		.title {			
			font-size: 7em;
			line-height: 75px;
		}
		.position{
			margin-top: 10px;
			font-size: 2em;
		}
  }
	
	
</style>
